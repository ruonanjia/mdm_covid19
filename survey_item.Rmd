---
title: "R Notebook"
output: html_notebook
author: ruonanjia
---

Install packages
```{r}
# Download package tarball from CRAN archive

url <- "https://cran.r-project.org/src/contrib/Archive/zipcode/zipcode_1.0.tar.gz"
pkgFile <- "zipcode_1.0.tar.gz"
download.file(url = url, destfile = pkgFile)

# Install dependencies

install.packages(c("ada", "ipred", "evd"))

# Install package
install.packages(pkgs=pkgFile, type="source", repos=NULL)

# Delete package tarball
unlink(pkgFile)
```


load library
```{r}
library(ggplot2)
library(zipcode) # install only available through archive
library(maps)
library(ggpubr)
library("PerformanceAnalytics") # for chart correlation
library(usmap) # for plotting data us maps
library(scales) # for muted() function
```

load data
```{r}
# setwd("E:/Ruonan/Projects in the lab/mdm_covid19/batch_data")
setwd("/Users/jiaruonan/Desktop/mdm_covid19/mdm_covid19_data")
load("data_all_444sub_rename.Rda")
load("data_all_444sub_rename_header.Rda")
load("data_all_444sub_attitude.Rda")

# combine data
data.all <- merge(data.all, data.attitude, by = "mTurkCode")
data.all$age <- as.numeric(as.character(data.all$age)) + 17 # correct coding
rm(data.attitude)
```

save into spread sheet
```{r}
# setwd("/Users/jiaruonan/Desktop/mdm_covid19/mdm_covid19_data")
# write.csv(header,"data_header.csv", row.names = FALSE)
# write.csv(data.all,"data_all_444sub.csv", row.names = FALSE)
```

Preprocess some data columns, run the following chunks before further analysis:
---
Separate young and old, compare with 60 yr
```{r}
data.all$is.young <- 1
data.all$is.young[data.all$age >= 60] = 0
data.all$is.young <- as.factor(data.all$is.young)
```

Clean zipcode
```{r}
# clean zipcode
data.all$zip_postal_code <- as.numeric(as.character(data.all$zip_postal_code))
data(zipcode)
data.all$zipcode<- clean.zipcodes(data.all$zip_postal_code)
```

End of preprocessing
---

take only the first response of the repeated subjects
```{r}
# dupli <- data.all$WorkerId[duplicated(data.all$WorkerId)] 
# dupli
# length(dupli)
# 
# data.repeat <- data.all[is.element(data.all$WorkerId, dupli),]
# nrow(data.repeat)
```

Look at column names
```{r}
colnames(data.all)
```


demographic block
```{r}
colnames(data.all)
colnames(data.all)[c(155:164,166:171, 1)]
t(header[1, c(155:164,166:171, 353)])


# age
ggplot(data.all, aes(x=age)) +
  geom_histogram(position = "identity", bins = 20) +
  labs(x = "Age")


#size by zip
data.zipcode<-aggregate(data.frame(count=data.all$mTurkCode),list(zip=data.all$zipcode),length)
geo<- merge(data.zipcode, zipcode, by='zip')

us<-map_data('state')

# note that this does not include Hawaii
ggplot(geo,aes(longitude,latitude)) +
  geom_polygon(data=us,aes(x=long,y=lat,group=group),color='gray',fill=NA,alpha=.35) +
  geom_point(aes(color = count),size=0.8,alpha=0.4) + 
  # scale_colour_gradient(high="dark blue", low="light blue") +
  # scale_color_continuous(breaks = c(1,2), labels = c(1,2)) +
  theme(panel.grid = element_blank(),
        axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(),
        panel.background = element_blank()) +
  xlim(-125,-65)+ylim(20,50) +
  ggtitle("Note: not including Hawaii and Alaska")
  

```


behavioral correlation with age
```{r}
ggplot(data.all[data.all$error.med<0.5,], aes(x=age, y=ambig_corr.med)) + 
  geom_point() +
  xlab("Age") + ylab("model-free ambig medical")

ggplot(data.all[data.all$error.mon<0.5,], aes(x=age, y=ambig_corr.mon)) + 
  geom_point() +
  xlab("Age") + ylab("model-free ambig Monetary")

ggplot(data.all[data.all$error.med<0.5,], aes(x=age, y=risk.med)) + 
  geom_point() +
  xlab("Age") + ylab("model-free risk Medical")

ggplot(data.all[data.all$error.mon<0.5,], aes(x=age, y=risk.mon)) + 
  geom_point() +
  xlab("Age") + ylab("model-free risk Monetary")
```

ambiguity block
```{r}
colnames(data.all)
ambig_col <- c(172:220)
colnames(data.all)[ambig_col]
```

News source
```{r}
# rank news source
# ambig1_news_sources_1 - ambig1_news_sources_8_TEXT

# source of news influencing opinion
# ambig1_sourcebelief_1 - ambig1_sourcebelief_7_TEXT

# time consuming news perday
hist(as.numeric(as.character(data.all$ambig1_news_perday)))

```

Health impact vs. economics impact
```{r}
# data.all$ambig2_health_impact
# data.all$ambig2_economics

x_labels = c("Extremely", "A lot", "Somewhat", "Uncertain", "Not much", "Not a lot", "Not at all")

ggplot(data.all, aes(x = ambig2_health_impact, fill=is.young)) +
  geom_histogram(stat="count") +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  ggtitle("Should consider health impact") +
  scale_x_discrete(labels=x_labels) +
  xlab("Extent")

ggplot(data.all, aes(x = ambig2_economics, fill=is.young)) +
  geom_histogram(stat="count") +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  scale_x_discrete(labels=x_labels) +
  ggtitle("Should consider economics impact") +
  xlab("Extent")

ggplot(data.all, aes(x=ambig2_health_impact, y=ambig2_economics)) + 
  geom_bin2d() +
  scale_x_discrete(labels=x_labels) +
  scale_y_discrete(labels=x_labels) +
  xlab("health") + ylab("economics") + 
  ggtitle("2D histogram") +
  theme_bw()
```

Health and economics impact, correlation with uncertainty attitude
```{r}
x_labels = c("Extremely", "A lot", "Somewhat", "Uncertain", "Not much", "Not a lot", "Not at all")

# data.all$ambig2_health_impact
sum(data.all$error.med<0.5)
ggplot(data.all[data.all$error.med<0.5,], aes(x=ambig2_health_impact, y=ambig_corr.med)) + 
  geom_violin() +
  scale_x_discrete(labels=x_labels) +
  xlab("Considering health impact") + ylab("model-free ambig medical")

ggplot(data.all[data.all$error.mon<0.5,], aes(x=ambig2_health_impact, y=ambig_corr.mon)) + 
  geom_violin() +
  scale_x_discrete(labels=x_labels) +
  xlab("Considering health impact") + ylab("model-free ambig monetary")

ggplot(data.all[data.all$error.med<0.5,], aes(x=ambig2_economics, y=ambig_corr.med)) + 
  geom_violin() +
  scale_x_discrete(labels=x_labels) +
  xlab("Considering econ impact") + ylab("model-free ambig medical")

ggplot(data.all[data.all$error.mon<0.5,], aes(x=ambig2_economics, y=ambig_corr.mon)) + 
  geom_violin() +
  scale_x_discrete(labels=x_labels) +
  xlab("Considering econ impact") + ylab("model-free ambig monetary")
```

Monetary and medical attitude correlation
```{r}
sum(data.all$error.med<0.5 & data.all$error.mon<0.5)
ggplot(data.all[data.all$error.med<0.5 & data.all$error.mon<0.5,], aes(x=ambig_corr.mon, y=ambig_corr.med)) + 
  geom_point() +
  geom_smooth(method="lm")

cor(data.all$ambig_corr.mon[data.all$error.med<0.5 & data.all$error.mon<0.5],
    data.all$ambig_corr.med[data.all$error.med<0.5 & data.all$error.mon<0.5])

ggplot(data.all[data.all$error.med<0.5 & data.all$error.mon<0.5,], aes(x=risk.mon, y=risk.med)) + 
  geom_point()

ggplot(data.all[data.all$error.mon<0.5,], aes(x=risk.mon, y=ambig_corr.mon)) + 
  geom_point()

cor(data.all$risk.mon[data.all$error.mon<0.5], data.all$ambig_corr.mon[data.all$error.mon<0.5])

ggplot(data.all[data.all$error.med<0.5,], aes(x=risk.med, y=ambig_corr.med)) + 
  geom_point()

cor(data.all$risk.med[data.all$error.med<0.5], data.all$ambig_corr.med[data.all$error.med<0.5])

```

How well informed 
```{r}
colnames(data.all)[c(194, 183, 195:199,391)]

# for (i in 193:198) {
#   data.all[, i] <- as.numeric(as.character(data.all[, i])) - 5
#   data.all[data.all[,i]!=1, i] <- data.all[data.all[,i]!=1, i] - 6
# }

my_data <- data.all[,c(194, 183, 195:199, 391)]
labels <- c("Very","Moderately","Somewhat","Uncertain","Somewhat not", "Moderately not","Very not")

colnames(my_data) <- c("self", "local_gov", "national_gov", "scientist", "healthcare", "economist", "familyfriends","is.young")

# look at histogram
# for (i in 1:length(my_data)) {
#   my_data[, i] <- as.numeric(as.character(my_data[, i]))
# }
# chart.Correlation(my_data, histogram=TRUE, pch=19)

for (i in 1:length(my_data)) {
  my_data[, i] <- as.factor(as.character(my_data[, i]))
}

# look at histogram
ggplot(my_data, aes(x=healthcare, y=economist)) + 
  geom_bin2d() +
  scale_x_discrete(labels=labels) +
  scale_y_discrete(labels=labels) +
  xlab("health") + ylab("economics") + 
  ggtitle("2D histogram") +
  theme_bw()

ggplot(my_data, aes(x=scientist, fill = is.young)) +
  geom_histogram(stat="count", position="stack") +
  scale_x_discrete(labels=labels) +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  ggtitle("How Well-informed")

ggplot(my_data, aes(x=healthcare, y=national_gov)) + 
  geom_bin2d() +
  scale_x_discrete(labels=labels) +
  scale_y_discrete(labels=labels) +  
  xlab("health") + ylab("goverment") + 
  ggtitle("2D histogram") +
  theme_bw()

ggplot(my_data, aes(x=self, fill = is.young)) +
  geom_histogram(stat="count", position="stack") +
  scale_x_discrete(labels=labels) +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  ggtitle("How Well-informed")

ggplot(my_data[!is.na(as.numeric(as.character(my_data$local_gov))),], 
       aes(x=local_gov, fill = is.young)) +
  geom_histogram(stat="count", position="stack") +
  scale_x_discrete(labels=labels) +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  ggtitle("How Well-informed")

ggplot(my_data, aes(x=national_gov, fill = is.young)) +
  geom_histogram(stat="count", position="stack") +
  scale_x_discrete(labels=labels) +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  ggtitle("How Well-informed")

ggplot(my_data, aes(x=healthcare, fill = is.young)) +
  geom_histogram(stat="count", position="stack") +
  scale_x_discrete(labels=labels) +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  ggtitle("How Well-informed")

ggplot(my_data, aes(x=economist, fill = is.young)) +
  geom_histogram(stat="count", position="stack") +
  scale_x_discrete(labels=labels) +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  ggtitle("How Well-informed")

ggplot(my_data, aes(x=familyfriends, fill = is.young)) +
  geom_histogram(stat="count", position="stack") +
  scale_x_discrete(labels=labels) +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  ggtitle("How Well-informed")

```

How much reaction
```{r}
colnames(data.all)[207:212]
react <- data.all[, c(207:212, 391)]

colnames(react) <- c("national","state","scientist","healthcare","economist","self","is.young")

labels <- c("Completely overreacting", "Somewhat overreacting","Appropriate","Somewhat insufficient", "Completely insufficient")

ggplot(react, aes(x=national, fill = is.young)) +
  geom_histogram(stat="count", position="stack") +
  scale_x_discrete(labels=labels) +
  rotate_x_text(30) +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  ggtitle("Reaction to pandemic")

ggplot(react[!is.na(as.numeric(as.character(react$state))),], aes(x=state, fill = is.young)) +
  geom_histogram(stat="count", position="stack") +
  scale_x_discrete(labels=labels) +
  rotate_x_text(30) +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  ggtitle("Reaction to pandemic")

ggplot(react, aes(x=scientist, fill = is.young)) +
  geom_histogram(stat="count", position="stack") +
  scale_x_discrete(labels=labels)  +
  rotate_x_text(30) +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  ggtitle("Reaction to pandemic")

ggplot(react, aes(x=healthcare, fill = is.young)) +
  geom_histogram(stat="count", position="stack") +
  scale_x_discrete(labels=labels) +
  rotate_x_text(30) +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  ggtitle("Reaction to pandemic")

ggplot(react, aes(x=economist, fill = is.young)) +
  geom_histogram(stat="count", position="stack") +
  scale_x_discrete(labels=labels) +
  rotate_x_text(30) +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  ggtitle("Reaction to pandemic")

ggplot(react, aes(x=self, fill = is.young)) +
  geom_histogram(stat="count", position="stack") +
  scale_x_discrete(labels=labels) +
  rotate_x_text(30) +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  ggtitle("Reaction to pandemic")

```

reaction and attitude
```{r}
ggplot(data.all[data.all$error.med<0.5,], aes(x=ambig1_react_nation, y=ambig_corr.med)) + 
  geom_violin() +
  geom_jitter(shape=16, position=position_jitter(0.2),size=0.8, alpha = 0.3,color="red") +
  geom_boxplot(width=0.1) +
  # geom_dotplot(binaxis='y', stackdir='center', dotsize=0.3) +
  xlab("National government reaction") +
  scale_x_discrete(labels=labels) +
  ylab("Model-free Ambig Medical") +
  # theme_classic() +
  rotate_x_text(20)


ggplot(data.all[data.all$error.mon<0.5,], aes(x=ambig1_react_nation, y=ambig_corr.mon)) + 
  geom_violin() +
  geom_jitter(shape=16, position=position_jitter(0.2),size=0.8, alpha=0.3,color="red") +
  geom_boxplot(width=0.1) +
  # geom_dotplot(binaxis='y', stackdir='center', dotsize=0.3) +
  xlab("National government reaction") +
  scale_x_discrete(labels=labels) +
  ylab("Model-free Ambig Monetary") +
  # theme_classic() +
  rotate_x_text(20)

ggplot(data.all[data.all$error.med<0.5,], aes(x=ambig1_react_nation, y=risk.med)) + 
  geom_violin() +
  geom_jitter(shape=16, position=position_jitter(0.2),size=0.8, alpha = 0.3,color="red") +
  geom_boxplot(width=0.1) +
  # geom_dotplot(binaxis='y', stackdir='center', dotsize=0.3) +
  xlab("National government reaction") +
  scale_x_discrete(labels=labels) +
  ylab("Model-free Risk Medical") +
  # theme_classic() +
  rotate_x_text(20)


ggplot(data.all[data.all$error.mon<0.5,], aes(x=ambig1_react_nation, y=risk.mon)) + 
  geom_violin() +
  geom_jitter(shape=16, position=position_jitter(0.2),size=0.8, alpha=0.3,color="red") +
  geom_boxplot(width=0.1) +
  # geom_dotplot(binaxis='y', stackdir='center', dotsize=0.3) +
  xlab("National government reaction") +
  scale_x_discrete(labels=labels) +
  ylab("Model-free Risk Monetary") +
  # theme_classic() +
  rotate_x_text(20)
```

Should consider health impact by state
```{r}
data.all$ambig2_health_impact <- as.numeric(as.character(data.all$ambig2_health_impact))

# location of county by zipcode
data.zipcode<-aggregate(
  data.frame(health_impact=4-data.all$ambig2_health_impact),list(zip=data.all$zipcode),
  mean,
  na.action=na.omit)

geo<- merge(data.zipcode, zipcode, by='zip')

# location of state by zipcodes
state_all <- unique(geo$state)
geo_state <- data.frame(state = state_all)

state_match <- match(geo$state, state_all)
for (idx in 1:length(state_all)) {
  geo_state$health_impact[idx] <- mean(geo$health_impact[geo$state==state_all[idx]],na.rm=TRUE)
}

# plot
plot_usmap(data=geo_state, regions="states",values="health_impact") +
  scale_fill_gradient2(limits=c(-1,3),midpoint=0,low=muted("blue"),high=muted("red")) +
  ggtitle("Should consider health impact") +
  labs(fill = "Extremely (Red) \n~ \nUncertain (White) \n~ \nNot at all (Blue) \n") +
  theme(legend.position = "right")

```

Should consider economic impact by state
```{r}

data.all$ambig2_economics <- as.numeric(as.character(data.all$ambig2_economics))

# location of county by zipcode
data.zipcode<-aggregate(
  data.frame(economic_impact=4-data.all$ambig2_economics),list(zip=data.all$zipcode),
  mean,
  na.action=na.omit)

geo<- merge(data.zipcode, zipcode, by='zip')

# location of state by zipcodes
state_all <- unique(geo$state)
geo_state <- data.frame(state = state_all)
# View(geo_state)

state_match <- match(geo$state, state_all)
for (idx in 1:length(state_all)) {
  geo_state$economic_impact[idx] <- mean(geo$economic_impact[geo$state==state_all[idx]],na.rm=TRUE)
}

# plot
plot_usmap(data=geo_state, regions="states",values="economic_impact") +
  scale_fill_gradient2(limits=c(-1,3),midpoint=0,low=muted("blue"),high=muted("red")) +
  ggtitle("Should consider economic impact") +
  labs(fill = "Extremely (Red) \n~ \nUncertain (White) \n~ \nNot at all (Blue) \n") +
  theme(legend.position = "right")

```

Health - economic impact
```{r}
data.all$ambig2_economics <- as.numeric(as.character(data.all$ambig2_economics))
data.all$ambig2_health_impact <- as.numeric(as.character(data.all$ambig2_health_impact))

# location of county by zipcode
data.zipcode<-aggregate(
  data.frame(health_economic=data.all$ambig2_economics-data.all$ambig2_health_impact),list(zip=data.all$zipcode),
  mean,
  na.action=na.omit)

geo<- merge(data.zipcode, zipcode, by='zip')

# location of state by zipcodes
state_all <- unique(geo$state)
geo_state <- data.frame(state = state_all)
# View(geo_state)

state_match <- match(geo$state, state_all)
for (idx in 1:length(state_all)) {
  geo_state$health_economic[idx] <- mean(geo$health_economic[geo$state==state_all[idx]],na.rm=TRUE)
}

# plot
plot_usmap(data=geo_state, regions="states",values="health_economic") +
  scale_fill_gradient2(midpoint=0,low=muted("blue"),high=muted("red")) +
  ggtitle("Should consider impact: heath-economic contrast") +
  labs(fill = "Health (Red) \n~ \nUnbiased (White) \n~ \nEconomic (Blue) \n") +
  theme(legend.position = "right")

```

How well-informed is the local government
```{r}

data.all$ambig1_gov_local <- as.numeric(as.character(data.all$ambig1_gov_local))

# location of county by zipcode
data.zipcode<-aggregate(
  data.frame(informed=4-data.all$ambig1_gov_local),list(zip=data.all$zipcode),
  mean,
  na.action=na.omit)

geo<- merge(data.zipcode, zipcode, by='zip')
# View(data.zipcode)
# View(geo)

# location of state by zipcodes
state_all <- unique(geo$state)
geo_state <- data.frame(state = state_all)

state_match <- match(geo$state, state_all)
for (idx in 1:length(state_all)) {
  geo_state$informed[idx] <- mean(geo$informed[geo$state==state_all[idx]],na.rm=TRUE)
}

# map the state data to us map
# geo_state_map <- map_with_data(geo_state, values="count", na=0)

# plot
plot_usmap(data=geo_state, regions="states",values="informed") +
  scale_fill_gradient2(midpoint=0,low=muted("blue"),high=muted("red")) +
  ggtitle("How well-informed is the local government") +
  labs(fill = "Very (Red) \n~ \nUncertain (White) \n~ \nVery not (Blue) \n") +
  # labs(fill = "Very not(-3) ~ Uncertain(0) ~ Very(3)") +
  theme(legend.position = "right")
```


How appropriate is the local government reaction by state
```{r}

data.all$ambig1_react_state <- as.numeric(as.character(data.all$ambig1_react_state))

# location of county by zipcode
data.zipcode<-aggregate(
  data.frame(react=data.all$ambig1_react_state-3),list(zip=data.all$zipcode),
  mean,
  na.action=na.omit)

geo<- merge(data.zipcode, zipcode, by='zip')
# View(data.zipcode)
# View(geo)

# location of state by zipcodes
state_all <- unique(geo$state)
geo_state <- data.frame(state = state_all)

state_match <- match(geo$state, state_all)
for (idx in 1:length(state_all)) {
  geo_state$react[idx] <- mean(geo$react[geo$state==state_all[idx]],na.rm=TRUE)
}

# plot
plot_usmap(data=geo_state, regions="states",values="react") +
  scale_fill_gradient2(midpoint=0) +
  ggtitle("How appropriate is the state government's reaction") +
  labs(fill = "Insufficient(Blue) \n~\nAppropriate(White) \n~\nOverreacting(Red) \n") +
  theme(legend.position = "right")

```

Anxiety level by state
```{r}
data.all$anx_feelingnow <- as.numeric(as.character(data.all$anx_feelingnow))

# location of county by zipcode
data.zipcode<-aggregate(
  data.frame(anx=data.all$anx_feelingnow)-4,list(zip=data.all$zipcode),
  mean,
  na.action=na.omit)

geo<- merge(data.zipcode, zipcode, by='zip')

# location of state by zipcodes
state_all <- unique(geo$state)
geo_state <- data.frame(state = state_all)

state_match <- match(geo$state, state_all)
for (idx in 1:length(state_all)) {
  geo_state$anx[idx] <- mean(geo$anx[geo$state==state_all[idx]],na.rm=TRUE)
}

# plot
plot_usmap(data=geo_state, regions="states",values="anx") +
  scale_fill_gradient2(midpoint=0,low=muted("blue"),high=muted("red")) +
  ggtitle("How anxious are you feeling now") +
  labs(fill = "Extremely (Red)\n~\nA fair amount (White) \n~\nNot at all (Blue)\n") +
  theme(legend.position = "right")

```

Count of participants by state
```{r}
# location of county by zipcode
data.zipcode<-aggregate(data.frame(count=data.all$mTurkCode),list(zip=data.all$zipcode),length)
geo<- merge(data.zipcode, zipcode, by='zip')
# View(data.zipcode)
# View(geo)

# location of state by zipcodes
state_all <- unique(geo$state)
geo_state <- data.frame(state = state_all)
View(geo_state)

state_match <- match(geo$state, state_all)
for (idx in 1:length(state_all)) {
  geo_state$count[idx] <- sum(geo$count[geo$state==state_all[idx]])
}

# map the state data to us map
# geo_state_map <- map_with_data(geo_state, values="count", na=0)

# plot
plot_usmap(data=geo_state, regions="states",values="count") +
  ggtitle("Count of participants") +
  labs(fill = "Count") +
  theme(legend.position = "right")
```

```{r}
#  library(maps)
us_map<-map_data('state')

library(sf)
us_states <- st_as_sf(map("state", plot = FALSE, fill = TRUE))

# state abbreviation to full name
data("state.fips")
state.name <- state.fips[,-1:-4]
state.name$polyname[c(21,23,35,39,55,60)] <- c("massachusetts", "michigan","new york","north carolina","virginia","washington")
state.name <- state.name[c(-20,-22,-24,-34,-36,-37,-38,-40,-53,-54,-56:-59),]
state.name[nrow(state.name)+1,] <- c("HI", "hawaii")


geo$state_full <- as.factor(state.name$polyname[match(geo$state, state.name$abb)])

us_states$count <- sum(geo$count[match(geo$state_full == us_states$ID)])

ggplot(us_states) +
  geom_sf(aes(fill = as.factor(count))) +
  # geom_text(aes(long, lat, label = count), color = "white") +
  # geom_point(aes(color = count),size=0.8,alpha=0.4) + 
  # scale_colour_gradient(high="dark blue", low="light blue") +
  # scale_color_continuous(breaks = c(1,2), labels = c(1,2)) +
  theme(panel.grid = element_blank(),
        axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(),
        panel.background = element_blank()) +
  xlim(-125,-65)+ylim(20,50)
  

```

Anxiety, distribution
```{r}
colnames(data.all)[309:317]

labels <- c("Not at all", "A little", "Somewhat", "A fair amount", "Much", "Very much", "Extremely")

ggplot(data.all, aes(x=anx_feelingnow, fill = is.young)) +
  geom_histogram(stat="count", position="stack") +
  scale_x_discrete(labels=labels) +
  # rotate_x_text(30) +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  xlab("Anxiety level now") +
  ggtitle("Anxiety now")

ggplot(data.all, aes(x=anx_TVnewspaper, fill = is.young)) +
  geom_histogram(stat="count", position="stack") +
  # scale_x_discrete(labels=labels) +
  # rotate_x_text(30) +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  ggtitle("Anxiety TV Newspaper")

ggplot(data.all, aes(x=anx_socialmedia, fill = is.young)) +
  geom_histogram(stat="count", position="stack") +
  # scale_x_discrete(labels=labels) +
  # rotate_x_text(30) +
  scale_fill_discrete(labels=c("Older", "Younger"), name="") +
  ggtitle("Anxiety social media")
```


Anxiety, violin plot
```{r}
labels <- c("Not at all", "A little", "Somewhat", "A fair amount", "Much", "Very much", "Extremely")

ggplot(data.all[data.all$error.med<0.5,], aes(x=anx_feelingnow, y=ambig_corr.med)) + 
  geom_point() +
  ylab("model-free ambig Medical")

ggplot(data.all[data.all$error.med<0.5,], aes(x=anx_feelingnow, y=ambig_corr.med)) + 
  geom_violin() +
  # geom_dotplot(binaxis='y', stackdir='center', dotsize=0.3) +
  xlab("Anxiety level now") +
  scale_x_discrete(labels=labels) +
  geom_jitter(shape=16, position=position_jitter(0.2),size=1,alpha=0.3,color="red") +
  geom_boxplot(width=0.1) +
  ylab("model-free ambig Medical")

ggplot(data.all[data.all$error.mon<0.5,], aes(x=anx_feelingnow, y=ambig_corr.mon)) + 
  geom_violin() +
  # geom_dotplot(binaxis='y', stackdir='center', dotsize=0.3) +
  xlab("Anxiety level now") +
  scale_x_discrete(labels=labels) +
  geom_jitter(shape=16, position=position_jitter(0.2),size=1,alpha=0.3,color="red") +
  geom_boxplot(width=0.1) +
  ylab("model-free ambig Monetary")

ggplot(data.all[data.all$error.med<0.5,], aes(x=anx_feelingnow, y=risk.med)) + 
  geom_violin() +
  # geom_dotplot(binaxis='y', stackdir='center', dotsize=0.3) +
  xlab("Anxiety level now") +
  scale_x_discrete(labels=labels) +
  geom_jitter(shape=16, position=position_jitter(0.2),size=1,alpha=0.3,color="red") +
  geom_boxplot(width=0.1) +
  ylab("model-free risk Medical")

ggplot(data.all[data.all$error.mon<0.5,], aes(x=anx_feelingnow, y=risk.mon)) + 
  geom_violin() +
  # geom_dotplot(binaxis='y', stackdir='center', dotsize=0.3) +
  xlab("Anxiety level now") +
  scale_x_discrete(labels=labels) +
  geom_jitter(shape=16, position=position_jitter(0.2),size=1,alpha=0.3,color="red") +
  geom_boxplot(width=0.1) +
  ylab("model-free risk Monetary")
```


risk exposure block
```{r}
data.all$Q1027
# those who themselves were infected with COVID-19
data.all$mTurkCode[data.all$Q1027 == 1]
# 2-immediate family, 3 - extended family, 9 - no
```

action block
```{r}

```


